(()=>{var e={427:(e,t,r)=>{const o=r(942),i=r(431);r(922),e.exports=function(){return{attacked:[],carrierHitbox:[],battleshipHitbox:[],destroyerHitbox:[],submarineHitbox:[],patrolboatHitbox:[],createBoard(e){const t=document.querySelector(".leftGrid"),r=document.querySelector(".rightGrid");let o=[],i=[0,1,2,3,4,5,6,7,8,9];i.forEach((e=>{for(let t=0;t<i.length;t++)o.push([e,i[t]])}));for(let i of o){let o=document.createElement("div");"player"==e?(o.classList.add("leftCells"),o.setAttribute("id",`left${[i[0],i[1]]}`),t.appendChild(o)):(o.classList.add("rightCells"),o.setAttribute("id",`right${[i[0],i[1]]}`),r.appendChild(o))}},placeShip(e,t,r){if(t[1]+e.length>10)return!1;const a=`${e.name}Hitbox`;for(let s=0;s<e.length;s++){const e=t[0],n=t[1]+s;this[a].push([e,n]),"player"==r?o([e,n],"green"):i([e,n],"green")}return this[a]},receiveAttack(e){this.attacked.push(e);const t=[this.carrierHitbox,this.battleshipHitbox,this.destroyerHitbox,this.submarineHitbox,this.patrolboatHitbox];for(let r of t){for(let t of r){if(t[0]==e[0]&&t[1]==e[1]){o(e,"red");break}o(e,"white")}break}return e},allShipsSunk:e=>e.every((e=>e.isSunk()))}}},942:e=>{e.exports=function(e,t){document.getElementById(`left${e[0]},${e[1]}`).style.backgroundColor=t}},431:e=>{e.exports=function(e,t){document.getElementById(`right${e[0]},${e[1]}`).style.backgroundColor=t}},922:e=>{e.exports=function(e,t,r){return{length:e,name:t,hit:r,gotHit(){if(e>r)return console.log("test"),this.hit+=1,this.hit},isSunk(){return this.length<=this.hit}}}}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{const e=r(922),t=r(427),o=(r(942),r(431));class i{constructor(e,t){this.name="player",this.board=e,this.carrier=this.createCarrier(),this.battleship=this.createBattleship(),this.destroyer=this.createDestroyer(),this.submarine=this.createSubmarine(),this.patrolboat=this.createPatrolboat(),this.ships=[this.carrier,this.battleship,this.destroyer,this.submarine,this.patrolboat],this.enemy="enemy",this.enemyBoard=t,this.enemyCarrier=this.createCarrier(),this.enemyBattleship=this.createBattleship(),this.enemyDestroyer=this.createDestroyer(),this.enemySubmarine=this.createSubmarine(),this.enemyPatrolboat=this.createPatrolboat(),this.enemyShips=[this.enemyCarrier,this.enemyBattleship,this.enemyDestroyer,this.enemySubmarine,this.enemyPatrolboat],this.enemyHitboxes=[this.enemyBoard.carrierHitbox,this.enemyBoard.battleshipHitbox,this.enemyBoard.destroyerHitbox,this.enemyBoard.submarineHitbox,this.enemyBoard.patrolboatHitbox]}attack(){"player"==this.name&&document.querySelectorAll(".rightCells").forEach((e=>{e.addEventListener("click",(()=>{let t=this.convertIdToCoord(e);for(let e of this.enemyBoard.attacked)console.log(e),t[0]==e[0]&&t[1]==e[1]?console.log("exist"):console.log("nope");const r=this.enemyHitboxes.reduce(((e,t)=>e.concat(t)),[]);for(let e of r){if(e[0]==t[0]&&e[1]==t[1]){o(t,"red"),this.findAttackedShip(t);break}o(t,"white")}console.log(r),setTimeout((()=>{this.board.receiveAttack(this.cpuAttackCoord())}),200)}))}))}cpuAttackCoord(){let e=this.generateCoord();for(;this.board.attacked.some((t=>t[0]==e[0]&&t[1]==e[1]));)e=this.generateCoord();return e}generateCoord(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}generateShipCoord(e){return[Math.floor(10*Math.random()),Math.floor(Math.random()*(10-e.length))]}convertIdToCoord(e){return[parseInt(e.id.charAt(5)),parseInt(e.id.charAt(7))]}findAttackedShip(e){this.enemyHitboxes.some(((t,r)=>{for(let o of t)o[0]==e[0]&&o[1]==e[1]&&(this.enemyShips[r].gotHit(),console.log("meow"),console.log(this.enemyBoard.attacked))}))}checkAttackedCoord(e){}placeCpuShips(){let e=[this.enemyCarrier,this.enemyBattleship,this.enemyDestroyer,this.enemySubmarine,this.enemyPatrolboat];for(let t of e){let e=[this.enemyBoard.carrierHitbox,this.enemyBoard.battleshipHitbox,this.enemyBoard.destroyerHitbox,this.enemyBoard.submarineHitbox,this.enemyBoard.patrolboatHitbox],r=[].concat(...e),o=this.generateShipCoord(t);for(;r.some((e=>e[0]==o[0]&&e[1]==o[1]+t.length||e[0]==o[0]&&e[1]==o[1]));)o=this.generateShipCoord(t);this.enemyBoard.placeShip(t,o,"enemy")}}checkGameOver(){this.board.allShipsSunk(this.ships)&&alert("You lost u fkn noob")}createPlayerBoard(){this.board.createBoard(this.name)}createEnemyBoard(){this.enemyBoard.createBoard("enemy")}createCarrier(){return e(5,"carrier",0)}createBattleship(){return e(4,"battleship",0)}createDestroyer(){return e(3,"destroyer",0)}createSubmarine(){return e(3,"submarine",0)}createPatrolboat(){return e(2,"patrolboat",0)}}!function(){let e=t(),r=t(),o=new i(r,e);o.createPlayerBoard(),o.createEnemyBoard(),o.placeCpuShips(),o.board.placeShip(o.carrier,[5,4],"player"),o.attack()}()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJLEdBQUtuRSxFQUFLVixRQUM3RTRGLEVBQUksSUFBTWYsRUFBSSxJQUFNZSxFQUFJLElBQU1mLEVBQUksTUFDOUJBLEVBQU03RCxLQUFLbUUsa0JBQWtCekUsR0FHakNNLEtBQUsyQixXQUFXbEMsVUFBVUMsRUFBTW1FLEVBQUssUUFFekMsQ0FFSixDQUNBZ0IsZ0JBQ083RSxLQUFLMEIsTUFBTXRCLGFBQWFKLEtBQUtLLFFBQzVCeUUsTUFBTSxzQkFFZCxDQUNBQyxvQkFDSS9FLEtBQUswQixNQUFNckQsWUFBWTJCLEtBQUtKLEtBQ2hDLENBQ0FvRixtQkFDSWhGLEtBQUsyQixXQUFXdEQsWUFBWSxRQUNoQyxDQUNBd0QsZ0JBRUksT0FEZ0JQLEVBQVksRUFBRyxVQUFXLEVBRTlDLENBQ0FTLG1CQUVJLE9BRG1CVCxFQUFZLEVBQUcsYUFBYyxFQUVwRCxDQUNBVyxrQkFFSSxPQURrQlgsRUFBWSxFQUFHLFlBQWEsRUFFbEQsQ0FDQWEsa0JBRUksT0FEa0JiLEVBQVksRUFBRyxZQUFhLEVBRWxELENBQ0FlLG1CQUVJLE9BRG1CZixFQUFZLEVBQUcsYUFBYyxFQUVwRCxHQUlKLFdBQ0ksSUFBSUssRUFBYUosSUFDYjBELEVBQWMxRCxJQUNkMkQsRUFBUyxJQUFJMUQsRUFBT3lELEVBQWF0RCxHQUNyQ3VELEVBQU9ILG9CQUNQRyxFQUFPRixtQkFFUEUsRUFBT1QsZ0JBQ1BTLEVBQU94RCxNQUFNakMsVUFBVXlGLEVBQU90RCxRQUFTLENBQUMsRUFBRSxHQUFJLFVBQzlDc0QsRUFBT3BDLFFBR1gsQ0FDQXFDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2xlZnRET00uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yaWdodERPTS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3NoaXBGYWN0b3J5LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBwbGF5ZXJET00gPSByZXF1aXJlKCcuL2xlZnRET00nKVxuY29uc3QgZW5lbXlET00gPSByZXF1aXJlKCcuL3JpZ2h0RE9NJylcbmNvbnN0IHNoaXBGYWN0b3J5ID0gcmVxdWlyZSgnLi9zaGlwRmFjdG9yeScpXG5mdW5jdGlvbiBnYW1lQm9hcmQoKXtcbiAgICByZXR1cm4ge1xuICAgICAgICBhdHRhY2tlZDogW10sXG4gICAgICAgIGNhcnJpZXJIaXRib3g6IFtdLFxuICAgICAgICBiYXR0bGVzaGlwSGl0Ym94OiBbXSxcbiAgICAgICAgZGVzdHJveWVySGl0Ym94OiBbXSxcbiAgICAgICAgc3VibWFyaW5lSGl0Ym94OiBbXSxcbiAgICAgICAgcGF0cm9sYm9hdEhpdGJveDogW10sXG5cbiAgICAgICAgY3JlYXRlQm9hcmQocGxheWVyTmFtZSl7XG4gICAgICAgICAgICBjb25zdCBsZWZ0R3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sZWZ0R3JpZCcpXG4gICAgICAgICAgICBjb25zdCByaWdodEdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmlnaHRHcmlkJylcbiAgICAgICAgICAgIGxldCBjb29yZHMgPSBbXTtcbiAgICAgICAgICAgIGxldCB4QXhpcyA9IFswLDEsMiwzLDQsNSw2LDcsOCw5XVxuICAgICAgICAgICAgeEF4aXMuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHhBeGlzLmxlbmd0aDsgaSsrKSBjb29yZHMucHVzaChbZWwsIHhBeGlzW2ldXSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgZm9yIChsZXQgZSBvZiBjb29yZHMpIHtcbiAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKHBsYXllck5hbWUgPT0gJ3BsYXllcicpe1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2xlZnRDZWxscycpO1xuICAgICAgICAgICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnaWQnLCBgbGVmdCR7W2VbMF0sIGVbMV1dfWApO1xuICAgICAgICAgICAgICAgICAgICBsZWZ0R3JpZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3JpZ2h0Q2VsbHMnKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJpZ2h0JHtbZVswXSwgZVsxXV19YCk7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0R3JpZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBsYWNlU2hpcChzaGlwLCBjb29yZCwgbmFtZSkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoY29vcmRbMV0gKyBzaGlwLmxlbmd0aCA+IDEwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGl0Ym94S2V5ID0gYCR7c2hpcC5uYW1lfUhpdGJveGA7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gY29vcmRbMF07XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IGNvb3JkWzFdICsgaTtcbiAgICAgICAgICAgICAgICB0aGlzW2hpdGJveEtleV0ucHVzaChbeCwgeV0pO1xuICAgICAgICAgICAgICAgIGlmKG5hbWUgPT0gJ3BsYXllcicpe1xuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJET00oW3gseV0sICdncmVlbicpXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZW5lbXlET00oW3gseV0sICdncmVlbicpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbaGl0Ym94S2V5XTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVjZWl2ZUF0dGFjayhjb29yZCkge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2tlZC5wdXNoKGNvb3JkKTtcbiAgICAgICAgICAgIGNvbnN0IHNoaXBIaXRib3hlcyA9IFt0aGlzLmNhcnJpZXJIaXRib3gsIHRoaXMuYmF0dGxlc2hpcEhpdGJveCwgdGhpcy5kZXN0cm95ZXJIaXRib3gsXG4gICAgICAgICAgICB0aGlzLnN1Ym1hcmluZUhpdGJveCwgdGhpcy5wYXRyb2xib2F0SGl0Ym94XVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IobGV0IHNoaXAgb2Ygc2hpcEhpdGJveGVzKXtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGhpdGJveGVzIG9mIHNoaXApe1xuICAgICAgICAgICAgICAgICAgICBpZihoaXRib3hlc1swXSA9PSBjb29yZFswXSAmJiBoaXRib3hlc1sxXSA9PSBjb29yZFsxXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29sb3IgPSAncmVkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyRE9NKGNvb3JkLCBjb2xvcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIHNoaXBIaXRib3hlcy5pbmRleE9mKHNoaXApXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbG9yID0gJ3doaXRlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyRE9NKGNvb3JkLCBjb2xvcilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb29yZFxuICAgICAgICB9LFxuICAgICAgICBhbGxTaGlwc1N1bmsoc2hpcHMpe1xuICAgICAgICAgICAgcmV0dXJuIHNoaXBzLmV2ZXJ5KHNoaXAgPT4gc2hpcC5pc1N1bmsoKSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBnYW1lQm9hcmQiLCJmdW5jdGlvbiBwbGF5ZXJET00oY29vcmQsIGNvbG9yKXtcbiAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBsZWZ0JHtjb29yZFswXX0sJHtjb29yZFsxXX1gKVxuICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3Jcbn1cbm1vZHVsZS5leHBvcnRzID0gcGxheWVyRE9NXG4iLCJmdW5jdGlvbiBlbmVteURPTShjb29yZCxjb2xvcikge1xuICAgIFxuICAgIGxldCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJpZ2h0JHtjb29yZFswXX0sJHtjb29yZFsxXX1gKVxuICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3Jcbn1cbiAgXG5cbi8qXG5mdW5jdGlvbiBjcHVET00oZ2FtZUJvYXJkLCBzaGlwc0FycmF5LCBvdmVyYWxsSGl0Ym94KXtcbiAgICBsZXQgZG9tQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmlnaHRHcmlkJylcbiAgICBnYW1lQm9hcmQuZm9yRWFjaChlID0+e1xuICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgncmlnaHRDZWxscycpXG4gICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdpZCcsIGAke1tlWzBdLCBlWzFdXX1gKVxuICAgICAgICBkb21Cb2FyZC5hcHBlbmRDaGlsZChjZWxsKVxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PntcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG92ZXJhbGxIaXRib3gpXG4gICAgICAgICAgICBvdmVyYWxsSGl0Ym94LmZvckVhY2goZSA9PntcbiAgICAgICAgICAgICAgICBpZihjZWxsLmlkID09IGAke2VbMF19LCR7ZVsxXX1gKXtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmVkJztcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5vcGFjaXR5ID0gJzAuNidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgIH0pXG4gICAgXG59XG4qL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGVuZW15RE9NIiwiZnVuY3Rpb24gc2hpcEZhY3RvcnkobGVuZ3RoLCBuYW1lLCBoaXQpe1xuICAgIHJldHVybntcbiAgICAgICAgbGVuZ3RoLFxuICAgICAgICBuYW1lLFxuICAgICAgICBoaXQsXG4gICAgICAgIGdvdEhpdCgpe1xuICAgICAgICAgICAgaWYobGVuZ3RoID4gaGl0KXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndGVzdCcpXG4gICAgICAgICAgICAgICAgdGhpcy5oaXQgKz0gMVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhpdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaXNTdW5rKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggPD0gdGhpcy5oaXQ7XG4gICAgICAgIH1cbiAgICB9ICAgXG59XG5cbm1vZHVsZS5leHBvcnRzID0gc2hpcEZhY3RvcnlcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJjb25zdCBzaGlwRmFjdG9yeSA9IHJlcXVpcmUoJy4vc2hpcEZhY3RvcnknKVxuY29uc3QgZ2FtZUJvYXJkID0gcmVxdWlyZSgnLi9nYW1lQm9hcmQnKVxuLy9jb25zdCBwbGF5ZXIgPSByZXF1aXJlKCcuL3BsYXllcicpXG4vL2NvbnN0IGNwdSA9IHJlcXVpcmUoJy4vcGxheWVyJylcbmNvbnN0IHBsYXllckRPTSA9IHJlcXVpcmUoJy4vbGVmdERPTScpXG5jb25zdCBlbmVteURPTSA9IHJlcXVpcmUoJy4vcmlnaHRET00nKTtcblxuY2xhc3MgUGxheWVye1xuICAgIGNvbnN0cnVjdG9yKGJvYXJkLGVuZW15Qm9hcmQpe1xuICAgICAgICB0aGlzLm5hbWUgPSAncGxheWVyJztcbiAgICAgICAgdGhpcy5ib2FyZCA9IGJvYXJkOyBcblxuICAgICAgICB0aGlzLmNhcnJpZXIgPSB0aGlzLmNyZWF0ZUNhcnJpZXIoKVxuICAgICAgICB0aGlzLmJhdHRsZXNoaXAgPSB0aGlzLmNyZWF0ZUJhdHRsZXNoaXAoKVxuICAgICAgICB0aGlzLmRlc3Ryb3llciA9IHRoaXMuY3JlYXRlRGVzdHJveWVyKClcbiAgICAgICAgdGhpcy5zdWJtYXJpbmUgPSB0aGlzLmNyZWF0ZVN1Ym1hcmluZSgpXG4gICAgICAgIHRoaXMucGF0cm9sYm9hdCA9IHRoaXMuY3JlYXRlUGF0cm9sYm9hdCgpXG5cbiAgICAgICAgdGhpcy5zaGlwcyA9IFt0aGlzLmNhcnJpZXIsIHRoaXMuYmF0dGxlc2hpcCwgdGhpcy5kZXN0cm95ZXIsIHRoaXMuc3VibWFyaW5lLCB0aGlzLnBhdHJvbGJvYXRdXG5cbiAgICAgICAgdGhpcy5lbmVteSA9ICdlbmVteSdcbiAgICAgICAgdGhpcy5lbmVteUJvYXJkID0gZW5lbXlCb2FyZDtcblxuICAgICAgICB0aGlzLmVuZW15Q2FycmllciA9IHRoaXMuY3JlYXRlQ2FycmllcigpXG4gICAgICAgIHRoaXMuZW5lbXlCYXR0bGVzaGlwID0gdGhpcy5jcmVhdGVCYXR0bGVzaGlwKClcbiAgICAgICAgdGhpcy5lbmVteURlc3Ryb3llciA9IHRoaXMuY3JlYXRlRGVzdHJveWVyKClcbiAgICAgICAgdGhpcy5lbmVteVN1Ym1hcmluZSA9IHRoaXMuY3JlYXRlU3VibWFyaW5lKClcbiAgICAgICAgdGhpcy5lbmVteVBhdHJvbGJvYXQgPSB0aGlzLmNyZWF0ZVBhdHJvbGJvYXQoKVxuXG4gICAgICAgIHRoaXMuZW5lbXlTaGlwcyA9IFt0aGlzLmVuZW15Q2FycmllciwgdGhpcy5lbmVteUJhdHRsZXNoaXAsIHRoaXMuZW5lbXlEZXN0cm95ZXIsXG4gICAgICAgIHRoaXMuZW5lbXlTdWJtYXJpbmUsIHRoaXMuZW5lbXlQYXRyb2xib2F0XVxuICAgICAgICBcbiAgICAgICAgdGhpcy5lbmVteUhpdGJveGVzID0gW3RoaXMuZW5lbXlCb2FyZC5jYXJyaWVySGl0Ym94LCB0aGlzLmVuZW15Qm9hcmQuYmF0dGxlc2hpcEhpdGJveCxcbiAgICAgICAgICAgIHRoaXMuZW5lbXlCb2FyZC5kZXN0cm95ZXJIaXRib3gsIHRoaXMuZW5lbXlCb2FyZC5zdWJtYXJpbmVIaXRib3gsXG4gICAgICAgICAgICB0aGlzLmVuZW15Qm9hcmQucGF0cm9sYm9hdEhpdGJveF1cbiAgICB9XG4gICAgYXR0YWNrKCl7XG4gICAgICAgIGlmKHRoaXMubmFtZSA9PSAncGxheWVyJyl7XG4gICAgICAgICAgICBjb25zdCBjcHVDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yaWdodENlbGxzJyk7XG4gICAgICAgICAgICBjcHVDZWxscy5mb3JFYWNoKGNlbGwgPT57XG4gICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57XG4gICAgICAgICAgICAgICAgICAgIGxldCBjZWxsQ29vcmQgPSB0aGlzLmNvbnZlcnRJZFRvQ29vcmQoY2VsbClcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBhdHQgb2YgdGhpcy5lbmVteUJvYXJkLmF0dGFja2VkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGF0dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjZWxsQ29vcmRbMF0gPT0gYXR0WzBdICYmIGNlbGxDb29yZFsxXSA9PSBhdHRbMV0pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdleGlzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm9wZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmVteUJvYXJkLmF0dGFja2VkLnNvbWUoY2QgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2VsbENvb3JkWzBdID09IGNkWzBdICYmIGNlbGxDb29yZFsxXSA9PSBjZFsxXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJhbGxIaXRib3hlcyA9IHRoaXMuZW5lbXlIaXRib3hlcy5yZWR1Y2UoKGFjYywgYXJyKSA9PiBhY2MuY29uY2F0KGFyciksIFtdKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBoYiBvZiBvdmVyYWxsSGl0Ym94ZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaGJbMF0gPT0gY2VsbENvb3JkWzBdICYmIGhiWzFdID09IGNlbGxDb29yZFsxXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlET00oY2VsbENvb3JkLCAncmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRBdHRhY2tlZFNoaXAoY2VsbENvb3JkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteURPTShjZWxsQ29vcmQsICd3aGl0ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG92ZXJhbGxIaXRib3hlcyk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9hcmQucmVjZWl2ZUF0dGFjayh0aGlzLmNwdUF0dGFja0Nvb3JkKCkpXG4gICAgICAgICAgICAgICAgICAgIH0sIDIwMClcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgY3B1QXR0YWNrQ29vcmQoKXtcbiAgICAgICAgbGV0IGdlbiA9IHRoaXMuZ2VuZXJhdGVDb29yZCgpO1xuICAgICAgICB3aGlsZSAodGhpcy5ib2FyZC5hdHRhY2tlZC5zb21lKGUgPT4gZVswXSA9PSBnZW5bMF0gJiYgZVsxXSA9PSBnZW5bMV0pKSB7XG4gICAgICAgICAgICBnZW4gPSB0aGlzLmdlbmVyYXRlQ29vcmQoKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnZW5cbiAgICB9XG4gICAgZ2VuZXJhdGVDb29yZCgpe1xuICAgICAgICByZXR1cm4gW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXVxuICAgIH1cbiAgICBnZW5lcmF0ZVNoaXBDb29yZChzaGlwKXtcbiAgICAgICAgcmV0dXJuIFtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMCAtIHNoaXAubGVuZ3RoKSldXG4gICAgfVxuICAgIGNvbnZlcnRJZFRvQ29vcmQoZWwpe1xuICAgICAgICByZXR1cm4gW3BhcnNlSW50KGVsLmlkLmNoYXJBdCg1KSksIHBhcnNlSW50KGVsLmlkLmNoYXJBdCg3KSldXG4gICAgfVxuICAgIGZpbmRBdHRhY2tlZFNoaXAoY29vcmQpe1xuICAgICAgICB0aGlzLmVuZW15SGl0Ym94ZXMuc29tZSgoc2hpcCwgaW5kZXgpID0+e1xuICAgICAgICAgICAgZm9yKGxldCBoYiBvZiBzaGlwKXtcbiAgICAgICAgICAgICAgICBpZihoYlswXSA9PSBjb29yZFswXSAmJiBoYlsxXSA9PSBjb29yZFsxXSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW5lbXlTaGlwc1tpbmRleF0uZ290SGl0KClcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ21lb3cnKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmVuZW15Qm9hcmQuYXR0YWNrZWQpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbiAgICBjaGVja0F0dGFja2VkQ29vcmQoY29vcmQpe1xuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgcGxhY2VDcHVTaGlwcygpe1xuICAgICAgICBsZXQgZW5lbXlTaGlwcyA9IFt0aGlzLmVuZW15Q2FycmllciwgdGhpcy5lbmVteUJhdHRsZXNoaXAsIHRoaXMuZW5lbXlEZXN0cm95ZXIsXG4gICAgICAgIHRoaXMuZW5lbXlTdWJtYXJpbmUsIHRoaXMuZW5lbXlQYXRyb2xib2F0XVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgc2hpcCBvZiBlbmVteVNoaXBzKXtcbiAgICAgICAgICAgIGxldCBvY2N1cGllZCA9IFt0aGlzLmVuZW15Qm9hcmQuY2FycmllckhpdGJveCwgdGhpcy5lbmVteUJvYXJkLmJhdHRsZXNoaXBIaXRib3gsXG4gICAgICAgICAgICAgICAgdGhpcy5lbmVteUJvYXJkLmRlc3Ryb3llckhpdGJveCwgdGhpcy5lbmVteUJvYXJkLnN1Ym1hcmluZUhpdGJveCwgXG4gICAgICAgICAgICAgICAgdGhpcy5lbmVteUJvYXJkLnBhdHJvbGJvYXRIaXRib3hdXG4gICAgICAgICAgICBsZXQgb2NjdXBpZWRUb3RhbCA9IFtdLmNvbmNhdCguLi5vY2N1cGllZClcbiAgICAgICAgICAgIGxldCBnZW4gPSB0aGlzLmdlbmVyYXRlU2hpcENvb3JkKHNoaXApXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdoaWxlKG9jY3VwaWVkVG90YWwuc29tZShvY2MgPT4gb2NjWzBdID09IGdlblswXSAmJiBvY2NbMV0gPT0gKGdlblsxXSArIHNoaXAubGVuZ3RoKSB8fFxuICAgICAgICAgICAgb2NjWzBdID09IGdlblswXSAmJiBvY2NbMV0gPT0gZ2VuWzFdKSl7XG4gICAgICAgICAgICAgICAgZ2VuID0gdGhpcy5nZW5lcmF0ZVNoaXBDb29yZChzaGlwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLmVuZW15Qm9hcmQucGxhY2VTaGlwKHNoaXAsIGdlbiwgJ2VuZW15JylcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbiAgICBjaGVja0dhbWVPdmVyKCl7XG4gICAgICAgIGlmKHRoaXMuYm9hcmQuYWxsU2hpcHNTdW5rKHRoaXMuc2hpcHMpKXtcbiAgICAgICAgICAgIGFsZXJ0KCdZb3UgbG9zdCB1IGZrbiBub29iJylcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGVQbGF5ZXJCb2FyZCgpe1xuICAgICAgICB0aGlzLmJvYXJkLmNyZWF0ZUJvYXJkKHRoaXMubmFtZSlcbiAgICB9XG4gICAgY3JlYXRlRW5lbXlCb2FyZCgpe1xuICAgICAgICB0aGlzLmVuZW15Qm9hcmQuY3JlYXRlQm9hcmQoJ2VuZW15JylcbiAgICB9XG4gICAgY3JlYXRlQ2Fycmllcigpe1xuICAgICAgICBjb25zdCBjYXJyaWVyID0gc2hpcEZhY3RvcnkoNSwgJ2NhcnJpZXInLCAwKVxuICAgICAgICByZXR1cm4gY2FycmllclxuICAgIH1cbiAgICBjcmVhdGVCYXR0bGVzaGlwKCl7XG4gICAgICAgIGNvbnN0IGJhdHRsZXNoaXAgPSBzaGlwRmFjdG9yeSg0LCAnYmF0dGxlc2hpcCcsIDApXG4gICAgICAgIHJldHVybiBiYXR0bGVzaGlwXG4gICAgfVxuICAgIGNyZWF0ZURlc3Ryb3llcigpe1xuICAgICAgICBjb25zdCBkZXN0cm95ZXIgPSBzaGlwRmFjdG9yeSgzLCAnZGVzdHJveWVyJywgMClcbiAgICAgICAgcmV0dXJuIGRlc3Ryb3llclxuICAgIH1cbiAgICBjcmVhdGVTdWJtYXJpbmUoKXtcbiAgICAgICAgY29uc3Qgc3VibWFyaW5lID0gc2hpcEZhY3RvcnkoMywgJ3N1Ym1hcmluZScsIDApXG4gICAgICAgIHJldHVybiBzdWJtYXJpbmVcbiAgICB9XG4gICAgY3JlYXRlUGF0cm9sYm9hdCgpe1xuICAgICAgICBjb25zdCBwYXRyb2xib2F0ID0gc2hpcEZhY3RvcnkoMiwgJ3BhdHJvbGJvYXQnLCAwKVxuICAgICAgICByZXR1cm4gcGF0cm9sYm9hdFxuICAgIH1cblxuXG59XG5mdW5jdGlvbiBnYW1lTG9vcCgpe1xuICAgIGxldCBlbmVteUJvYXJkID0gZ2FtZUJvYXJkKClcbiAgICBsZXQgcGxheWVyQm9hcmQgPSBnYW1lQm9hcmQoKVxuICAgIGxldCBwbGF5ZXIgPSBuZXcgUGxheWVyKHBsYXllckJvYXJkLCBlbmVteUJvYXJkKVxuICAgIHBsYXllci5jcmVhdGVQbGF5ZXJCb2FyZCgpXG4gICAgcGxheWVyLmNyZWF0ZUVuZW15Qm9hcmQoKVxuICAgIFxuICAgIHBsYXllci5wbGFjZUNwdVNoaXBzKClcbiAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHBsYXllci5jYXJyaWVyLCBbNSw0XSwgJ3BsYXllcicpXG4gICAgcGxheWVyLmF0dGFjaygpXG4gICAgXG4gICAgXG59XG5nYW1lTG9vcCgpXG4vKlxuZnVuY3Rpb24gZ2FtZUxvb3AoKXtcbiAgICBsZXQgZW5lbXlCb2FyZCA9IGdhbWVCb2FyZCgpXG4gICAgbGV0IHBsYXllckJvYXJkID0gZ2FtZUJvYXJkKClcbiAgICBsZXQgcGxheWVyID0gbmV3IFBsYXllcigncGxheWVyJywgcGxheWVyQm9hcmQsIGVuZW15Qm9hcmQpXG4gICAgcGxheWVyLmNyZWF0ZVBsYXllckJvYXJkKClcbiAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHBsYXllci5jYXJyaWVyLCBbNSw0XSlcbiAgICBcbiAgICBsZXQgY3B1Qm9hcmQgPSBnYW1lQm9hcmQoKVxuICAgIGxldCBjcHUgPSBuZXcgUGxheWVyKCdjcHUnLCBjcHVCb2FyZClcbiAgICBjcHUuY3JlYXRlUGxheWVyQm9hcmQoKVxuICAgIHBsYXllci5hdHRhY2soKVxufVxuZ2FtZUxvb3AoKVxuKi9cblxuLypcbmZ1bmN0aW9uIHBsYXllcigpe1xuICAgIGNvbnNvbGUubG9nKCdwcHBwJyk7XG4gICAgbGV0IHRlc3RDb29yZCA9IFs1LDRdXG4gICAgbGV0IGRvbUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxlZnRHcmlkJylcbiAgICBsZXQgcGxheWVyTmFtZSA9ICdwbGF5ZXInXG4gICAgY29uc3QgY2FycmllciA9IHNoaXBGYWN0b3J5KDUsICdjYXJyaWVyJywgMClcbiAgICBjb25zdCBiYXR0bGVzaGlwID0gc2hpcEZhY3RvcnkoNCwgJ2JhdHRsZXNoaXAnLCAwKVxuICAgIGNvbnN0IGRlc3Ryb3llciA9IHNoaXBGYWN0b3J5KDMsICdkZXN0cm95ZXInLCAwKVxuICAgIGNvbnN0IHN1Ym1hcmluZSA9IHNoaXBGYWN0b3J5KDMsICdzdWJtYXJpbmUnLCAwKVxuICAgIGNvbnN0IHBhdHJvbGJvYXQgPSBzaGlwRmFjdG9yeSgyLCAncGF0cm9sYm9hdCcsIDApXG4gICAgY29uc3QgcGxheWVyR2FtZUJvYXJkID0gZ2FtZUJvYXJkKClcbiAgICBwbGF5ZXJHYW1lQm9hcmQuY3JlYXRlQm9hcmQoZG9tQm9hcmQscGxheWVyTmFtZSlcbiAgICBwbGF5ZXJHYW1lQm9hcmQucGxhY2VTaGlwKGNhcnJpZXIsIFs1LDRdKVxuICAgIHBsYXllckdhbWVCb2FyZC5wbGFjZVNoaXAoYmF0dGxlc2hpcCwgWzIsNl0pXG4gICAgcGxheWVyR2FtZUJvYXJkLnBsYWNlU2hpcChkZXN0cm95ZXIsIFsxLDVdKVxuICAgIHBsYXllckdhbWVCb2FyZC5wbGFjZVNoaXAoc3VibWFyaW5lLCBbNCw0XSlcbiAgICBwbGF5ZXJHYW1lQm9hcmQucGxhY2VTaGlwKHBhdHJvbGJvYXQsIFs2LDRdKVxuICAgIGNvbnN0IHNoaXBzID0gW2NhcnJpZXIsIGJhdHRsZXNoaXAsIGRlc3Ryb3llciwgc3VibWFyaW5lLCBwYXRyb2xib2F0XTtcbiAgICBjb25zdCBzaGlwSGl0Ym94ID0gW11cbiAgICBsZXQgY3B1QXR0YWNrQ29vcmQgPSBbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOSksTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOSldXG4gICAgbGV0IGF0dGFja2VkQ29vcmQgPSBwbGF5ZXJHYW1lQm9hcmQucmVjZWl2ZUF0dGFjayh0ZXN0Q29vcmQsIHNoaXBzKVxuICAgIHNoaXBzW2F0dGFja2VkQ29vcmRdLmdvdEhpdCgpXG4gICAgXG5cbn1cbmZ1bmN0aW9uIGNwdSgpe1xuICAgIGNvbnN0IGRvbUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJpZ2h0R3JpZCcpXG4gICAgbGV0IHBsYXllck5hbWUgPSAnY3B1J1xuICAgIGNvbnN0IGNhcnJpZXIgPSBzaGlwRmFjdG9yeSg1LCAnY2FycmllcicpXG4gICAgY29uc3QgYmF0dGxlc2hpcCA9IHNoaXBGYWN0b3J5KDQsICdiYXR0bGVzaGlwJylcbiAgICBjb25zdCBkZXN0cm95ZXIgPSBzaGlwRmFjdG9yeSgzLCAnZGVzdHJveWVyJylcbiAgICBjb25zdCBzdWJtYXJpbmUgPSBzaGlwRmFjdG9yeSgzLCAnc3VibWFyaW5lJylcbiAgICBjb25zdCBwYXRyb2xib2F0ID0gc2hpcEZhY3RvcnkoMiwgJ3BhdHJvbGJvYXQnKVxuICAgIGNvbnN0IGNwdUdhbWVCb2FyZCA9IGdhbWVCb2FyZCgpXG4gICAgY3B1R2FtZUJvYXJkLmNyZWF0ZUJvYXJkKGRvbUJvYXJkLCBwbGF5ZXJOYW1lKVxuICAgIGNwdUdhbWVCb2FyZC5wbGFjZVNoaXAoY2FycmllciwgWzUsNF0pXG4gICAgY3B1R2FtZUJvYXJkLnBsYWNlU2hpcChiYXR0bGVzaGlwLCBbMiw2XSlcbiAgICBjcHVHYW1lQm9hcmQucGxhY2VTaGlwKGRlc3Ryb3llciwgWzEsNV0pXG4gICAgY3B1R2FtZUJvYXJkLnBsYWNlU2hpcChzdWJtYXJpbmUsIFs0LDRdKVxuICAgIGNwdUdhbWVCb2FyZC5wbGFjZVNoaXAocGF0cm9sYm9hdCwgWzUsNF0pXG4gICAgXG4gICBcblxufVxuKi9cbiJdLCJuYW1lcyI6WyJwbGF5ZXJET00iLCJlbmVteURPTSIsIm1vZHVsZSIsImV4cG9ydHMiLCJhdHRhY2tlZCIsImNhcnJpZXJIaXRib3giLCJiYXR0bGVzaGlwSGl0Ym94IiwiZGVzdHJveWVySGl0Ym94Iiwic3VibWFyaW5lSGl0Ym94IiwicGF0cm9sYm9hdEhpdGJveCIsImNyZWF0ZUJvYXJkIiwicGxheWVyTmFtZSIsImxlZnRHcmlkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmlnaHRHcmlkIiwiY29vcmRzIiwieEF4aXMiLCJmb3JFYWNoIiwiZWwiLCJpIiwibGVuZ3RoIiwicHVzaCIsImUiLCJjZWxsIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwicGxhY2VTaGlwIiwic2hpcCIsImNvb3JkIiwibmFtZSIsImhpdGJveEtleSIsIngiLCJ5IiwidGhpcyIsInJlY2VpdmVBdHRhY2siLCJzaGlwSGl0Ym94ZXMiLCJoaXRib3hlcyIsImFsbFNoaXBzU3VuayIsInNoaXBzIiwiZXZlcnkiLCJpc1N1bmsiLCJjb2xvciIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoaXQiLCJnb3RIaXQiLCJjb25zb2xlIiwibG9nIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsInNoaXBGYWN0b3J5IiwiZ2FtZUJvYXJkIiwiUGxheWVyIiwiY29uc3RydWN0b3IiLCJib2FyZCIsImVuZW15Qm9hcmQiLCJjYXJyaWVyIiwiY3JlYXRlQ2FycmllciIsImJhdHRsZXNoaXAiLCJjcmVhdGVCYXR0bGVzaGlwIiwiZGVzdHJveWVyIiwiY3JlYXRlRGVzdHJveWVyIiwic3VibWFyaW5lIiwiY3JlYXRlU3VibWFyaW5lIiwicGF0cm9sYm9hdCIsImNyZWF0ZVBhdHJvbGJvYXQiLCJlbmVteSIsImVuZW15Q2FycmllciIsImVuZW15QmF0dGxlc2hpcCIsImVuZW15RGVzdHJveWVyIiwiZW5lbXlTdWJtYXJpbmUiLCJlbmVteVBhdHJvbGJvYXQiLCJlbmVteVNoaXBzIiwiZW5lbXlIaXRib3hlcyIsImF0dGFjayIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiY2VsbENvb3JkIiwiY29udmVydElkVG9Db29yZCIsImF0dCIsIm92ZXJhbGxIaXRib3hlcyIsInJlZHVjZSIsImFjYyIsImFyciIsImNvbmNhdCIsImhiIiwiZmluZEF0dGFja2VkU2hpcCIsInNldFRpbWVvdXQiLCJjcHVBdHRhY2tDb29yZCIsImdlbiIsImdlbmVyYXRlQ29vcmQiLCJzb21lIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2VuZXJhdGVTaGlwQ29vcmQiLCJwYXJzZUludCIsImlkIiwiY2hhckF0IiwiaW5kZXgiLCJjaGVja0F0dGFja2VkQ29vcmQiLCJwbGFjZUNwdVNoaXBzIiwib2NjdXBpZWQiLCJvY2N1cGllZFRvdGFsIiwib2NjIiwiY2hlY2tHYW1lT3ZlciIsImFsZXJ0IiwiY3JlYXRlUGxheWVyQm9hcmQiLCJjcmVhdGVFbmVteUJvYXJkIiwicGxheWVyQm9hcmQiLCJwbGF5ZXIiLCJnYW1lTG9vcCJdLCJzb3VyY2VSb290IjoiIn0=